{"title":"Lab 1: FPGA and MCU Setup and Testing","markdown":{"headingText":"Lab 1: FPGA and MCU Setup and Testing","containsRefs":false,"markdown":"\n### Introduction\n\nIn this lab, a design was implemented on the UPduino v3.1 FPGA to interface with and demonstrate the proper assembly of the E155 Development Board. This lab also exhibited the functionalities of the Dev Board's LEDs, the FPGA's on-board high-speed oscillator, and a Seven Segment Display.\n\n\n### Design and Testing Methodology\nThe iCE40 UltraPlus HSOSC primitive- an on-board high-speed oscillator- was used to generate a clock signal at 48 MHz. \n\nA separate clock divider module was created to divide the HSOSC signal to a frequency of 2.4 Hz using a counter that reset every 10,000 counts. This drove an external LED.\n\nLogic to control the other two on-board LEDs included a simple XOR gate and AND gate between two sets of switches.\n\nTo control the input to the Seven Segment Display, a priority encoder was used. The output signals were mapped to their respective pins on the input of the HDSP-511A Seven Segment Display. 3.3V were applied to the common anode of the display. \nTo turn a segment ON, the respective GPIO pin was grounded, producing a 3.3V drop across the segment's anode. The forward voltage of the segments' diodes is 1.95V. The current flowing through the diode was chosen to be 1mA. Therefore the value of the current limiting resistor placed in series between the cathode and GPIO pin was 1 kΩ. Calculations for this component value can be found below.\n\n\n![Figure 1: Calculations for the current-limiting resistor values](images/resistor.png){width=50% fig-align=\"center\"}\n\nTo turn a segment OFF, the respective GPIO pin was set to 3.3V, producing no voltage drop across the segment, therefore allowing no current to flow.\n\nTo test this design, all different combinations of the four input switches were tried out, ensuring that each produced the desired segment display and LED-illumination. In testing the frequency of the blinking LED, the number of flashes that occured within 10 seconds were counted. This number- 23 flashes- was divided by 10 to confirm a frequency of 2.4 Hz.\n\n### Technical Documentation\n\nThe source code for Lab 1 can be found in the following [GitHub repository](https://github.com/Isabella-Hottenrott/e155-lab1).\n\n#### Block Diagram\n\n\n![Figure 2: Block Diagram of the lab1_ih verilog design](images/blockdiagram.png){width=60% fig-align=\"center\"}\n\nThe block diagram above illustrates the lab1_ih design. The top level module is called lab1_ih and takes the input s[3:0] and outputs led[2:0] and segs[6:0], communicating with the GPIO pins. Lab1_ih includes three submodules: the high-speed oscillator block (hf_osc), the seven segments priority encoder (segments), and the clock divider to 2.4 Hz (clock_div).\n\n#### Schematic\n\n\n![Figure 3: Schematic of the Physical Circuit](images/schematic.png){width=50% fig-align=\"center\"}\n\n\nThe schematic above illustrates the physical layout on the breadboard. The diode cathodes from the seven segment display were connected in series with a 1 kΩ current-limiting resistor. Similarly, the on-board LEDs required 1 kΩ resistors to their limit current. Internal 100kΩ pull-up resistors were used to keep the active low SW7 from floating.\n\n### Results and Discussion\n\nThis design met the intended objectives. All switches perform the intended logic, as can be demonstrated on the board by performing all switch combinations. A testbench simulation to verify the SystemVerilog design was not provided for this lab. This was a missing component of this project.\n\n\n### Conclusion\n\nThe design successfully blinked an external LED using the on-board high-speed oscillator. Doing so demonstrated that the development board was properly assembled. I spent a total of twenty hours working on this lab.\n\n### AI Prototype Summary\n\nThe prompt that I provided the LLM was: \"Write SystemVerilog HDL to leverage the internal high speed oscillator in the Lattice UP5K FPGA and blink an LED at 2 Hz. Take full advantage of SystemVerilog syntax, for example, using logic instead of wire and reg.\"\n\nIn response, it provided me with the following:\n\n    // Blink an LED at ~2 Hz using the iCE40UP5K internal HFOSC.\n    // Toolchains: Lattice Radiant/iCEcube2 or open-source (yosys/nextpnr-ice40).\n\n    module up5k_led_blink_2hz (\n        output logic led_o   // drive your LED pin (active-high assumed)\n    );\n\n    logic clk_12mhz;\n\n    SB_HFOSC u_hfosc (\n        .CLKHFEN (1'b1),   // enable output (assert after 100 µs PU time)\n        .CLKHFPU (1'b1),   // power-up oscillator\n        .CLKHF   (clk_12mhz)\n    );\n   \n    localparam int unsigned F_CLK_HZ = 12_000_000;\n    localparam int unsigned F_BLINK_HZ = 2;\n    localparam int unsigned TICKS_PER_TOGGLE = F_CLK_HZ / (2 * F_BLINK_HZ);\n\n    localparam int COUNTER_W = $clog2(TICKS_PER_TOGGLE);\n    logic [COUNTER_W-1:0] tick_cnt /* synthesis preserve */;\n\n    always_ff @(posedge clk_12mhz) begin\n        if (tick_cnt == TICKS_PER_TOGGLE-1) begin\n            tick_cnt <= '0;\n            led_o    <= ~led_o;       // toggle at 2 Hz\n        end else begin\n            tick_cnt <= tick_cnt + 1;\n        end\n    end\n\n    initial led_o = 1'b0;\n\n    endmodule\n\n\n\nWhen I attempted to synthesize this design, I thrown the error \"instantiating unknown module SB_HFSOSC. VERI-1063\". I typed the error message back into the LLM, and it corrected itself by instantiating the module \"SB_HFOSC\". The LLM had falsely named the Lattice iCE40/UP5K primitive of the on-board FPGA.\n\nI would overall rate the quality of the output poorly. I used ChatGPT 5 for this task, and would have expected it to not make such a basic and obvious mistake. The prompt asked to produce a very simple design, so I found it surprising that the LLM's output didn't synthesize on the first try. I also found the mistake surprising, because there should be a correlation between \"iCE40/UP5K\" and \"SB_HFOSC\", rather than \"SB_HFSOSC\" in the data that the chatbot used to create its answer. \n\nOtherwise, the logic that the LLM created made sense, and the chatbot attempted to use local parameters and calculations to arrive at values necessary for the clock division. This makes the design modular.","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"toc":true,"output-file":"lab1.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.33","theme":["cosmo","brand"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}